<!DOCTYPE html>

<meta charset="utf-8" />	

<form class="form-horizontal" role="form"  onsubmit="return submitForm(this);"
 action="mpamng/term/eidtTermFee.do" id="termFee_form">
 	<input type="hidden" id="type" name="type" />
 	<input type="hidden" id="feeCode" name="feeCode" />
 	<input type="hidden" id="terminalId" name="terminalId" />
 	<input type="hidden" id="agentId" name="agentId" />
 	<input type="hidden" id="custId" name="custId" />
 	
	<!-- #section:elements.form -->
	<br/>
	<div class="form-group">
		<label class="col-sm-2 control-label no-pEditing-right"for="form-field-1"> 代理商名称 </label>
		<div class="col-sm-8">
			<input type="text" id="agentName" name="agentName" placeholder="代理商编号" class="col-xs-10 col-sm-7" readonly="readonly"/>
		</div>
	</div>

	<div class="form-group">
		<label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 终端物理号 </label>
		<div class="col-sm-8">
			<input type="text" id="terminalNo" name="terminalNo" placeholder="终端物理号" class="col-xs-10 col-sm-5" readonly="readonly"/>
		</div>
	</div>
	<div class="form-group">
		<label class="col-sm-2 control-label no-padding-right">
			T0提现(%)： </label>
		<div class="col-sm-3">
			<span class="block input-icon input-icon-right" >
				<input type="text" id="rateTCas" name="rateTCas" placeholder="T0提现(0.6%)" 
					class="col-xs-12 col-sm-12 feecheck" value="" datatype="Dnumber" maxlength="4" />
				<i class="ace-icon">%</i>
			</span>
		</div>
		<label class="col-sm-2 control-label no-padding-right">
			T0提现单笔收费： </label>
		<div class="col-sm-3">
			<span class="block input-icon input-icon-right" >
				<input type="text" id="maxTCas" name="maxTCas" placeholder="T0提现单笔收费(单位元)" 
				class="col-xs-12 col-sm-12 feecheck" datatype="money" maxlength="8" value="0"/>
			</span>
		</div>
	</div>
	<div class="form-group">
		<label class="col-sm-2 control-label no-padding-right">
			民生类(%)： </label>
		<div class="col-sm-3">
			<span class="block input-icon input-icon-right" >
				<input type="text" id="rateLivelihood" name="rateLivelihood" placeholder="民生类(0.38%)"
					class="col-xs-12 col-sm-12 feecheck" value="" judge="agentRate" maxlength="4" datatype="Dnumber" readonly/>
				<i class="ace-icon">%</i>
			</span>
		</div>
	</div>
	
	<div class="form-group">
		<label class="col-sm-2 control-label no-padding-right">
			一般类(%)： </label>
		<div class="col-sm-3">
			<span class="block input-icon input-icon-right" >
				<input type="text" id="rateGeneral" name="rateGeneral" placeholder="一般类(0.78%)" 
					class="col-xs-12 col-sm-12 feecheck" value="" judge="agentRate" maxlength="4" datatype="Dnumber" readonly/>
				<i class="ace-icon">%</i>
			</span>
		</div>
	</div>
	
	<div class="form-group">
		<label class="col-sm-2 control-label no-padding-right">
			餐娱类(%)： </label>
		<div class="col-sm-3">
			<span class="block input-icon input-icon-right" >
				<input type="text" id="rateEntertain" name="rateEntertain" placeholder="餐娱类(1.25%)"
					class="col-xs-12 col-sm-12 feecheck" value="" datatype="Dnumber" judge="agentRate" maxlength="4" readonly/>
				<i class="ace-icon">%</i>
			</span>
		</div>
	</div>
	
	<div class="form-group">
		<label class="col-sm-2 control-label no-padding-right">
			批发类(%)： </label>
		<div class="col-sm-3">
			<span class="block input-icon input-icon-right" >
				<input type="text" id="rateGeneralTop" name="rateGeneralTop" placeholder="批发类(0.78%)"
					class="col-xs-12 col-sm-12 feecheck" value="" judge="agentRate" maxlength="4" datatype="Dnumber" readonly/>
				<i class="ace-icon">%</i>
			</span>
		</div>
		<label class="col-sm-2 control-label no-padding-right">
			批发类封顶(元)： </label>
		<div class="col-sm-3">
			<input type="text" id="rateGeneralMaximun" name="rateGeneralMaximun" placeholder="批发类封顶(0.78%，单位元)" init-format="cent2Yuan('{value}',false)"
				class="col-xs-12 col-sm-12 feecheck" value="" datatype="money" judge="agentRate" judge-ref="rateGeneralTop" maxlength="12" readonly/>
		</div>
	</div>
	
	<div class="form-group">
		<label class="col-sm-2 control-label no-padding-right">
			房产类(%)： </label>
		<div class="col-sm-3">
			<span class="block input-icon input-icon-right" >
				<input type="text" id="rateEntertainTop" name="rateEntertainTop" placeholder="房产类封顶(1.25%)" 
					class="col-xs-12 col-sm-12 feecheck" value="" datatype="money" judge="agentRate" maxlength="4" datatype="Dnumber" readonly/>
				<i class="ace-icon">%</i>
			</span>
		</div>
		<label class="col-sm-2 control-label no-padding-right">
			房产类封顶(元)： </label>
		<div class="col-sm-3">
			<input type="text" id="rateEntertainMaximun" name="rateEntertainMaximun" placeholder="房产类封顶(1.25%，单位元)" init-format="cent2Yuan('{value}',false)"
				class="col-xs-12 col-sm-12 feecheck" value="" datatype="money" judge="agentRate" judge-ref="rateGeneralTop" maxlength="12" readonly/>
		</div>
	</div>
	
	
	<div class="form-group">
		
	</div>
	
	<br/><br/>
	<div class="form-actions align-right  form-button-box" style="margin-top: 10px">
		<button id="save" class="btn btn-info" type="submit">保存</button>
		&nbsp; 
		<button class="btn" type="button" onclick="javascript:dialog.closeById('dlg-termFeeEdit');">关闭</button>
	</div>
	
</form>
<script type="text/javascript">

$(document).ready(function() {
	setType();
	getPAgentInfo();
}); 

var agentInf;
function setType(){
	var dialog=$("#dlg-termFeeEdit").Dialog();
	if(dialog.pageParam.type=='view'){
		$("#save").remove();
		$("#termFee_form input[type=text]").attr("readonly","readonly");
		$("#termFee_form input[type=text]").attr("placeholder","");
	}else{
		// 异步加载代理商费率参数
		msg_Title="终端";
		$.ajax({
			type : "post",
			url : "mpamng/agent/outOfRate.do",
			data:{rateType:"term",agentId:dialog.pageParam.agentId},
			dataType : 'json',
			success : function(result) {
				if (result.rspcod != 200) {
					msg.alert("错误", result.rspmsg, 'error');
				} else {
					agentInf=result.obj;
				}
			},
			error : function(XMLHttpRequest, textStatus) {
				msg.alert("错误", "错误代码：" + XMLHttpRequest.status + ",错误描述："+ textStatus, 'error');
			}
		});
	}
}


function submitForm(obj){
	var $form = $('#termFee_form');
	var bool = TDValidateForm($form);
	if(!bool){
		return false;
	}
	return validateCallback(obj,editUserDone);
}

function editUserDone(result){
	if(result.rspcod== 200){
		msg.alert("提示",result.rspmsg,'correct');
		$("#grid-table").trigger("reloadGrid");
		dialog.closeById('dlg-termFeeEdit');
	}else{
		msg.alert("错误",result.rspmsg,'error');
	}
}

//异步加载上级代理商费率参数
function getPAgentInfo(){
	var dialog1=$("#dlg-termFeeEdit").Dialog();
	if(dialog1.dataParam.type!='eidt'){
		return;
	}
	
	if(dialog1.dataParam.agentId == null || dialog1.dataParam.agentId ==''){
		return;
	}
	$.ajax({
		type : "post",
		url : "mpamng/agent/queryAgentById.do",
		dataType : 'json',
		data : {
			agentId : dialog1.dataParam.agentId
		},		
		success : function(result) {
			if (result.rspcod != 200) {
				msg.alert("错误", result.rspmsg, 'error');
			} else {
				//根据传入的值判断是否启用编辑
				var p_rateLivelihood = result.obj.rateLivelihood;//民生类
				var p_rateGeneral = result.obj.rateGeneral;//一般类
				var p_rateEntertain = result.obj.rateEntertain;//餐娱类
				var p_rateGeneralTop = result.obj.rateGeneralTop;//批发类
				var p_rateGeneralMaximun = result.obj.rateGeneralMaximun;//批发类封顶
				var p_rateEntertainTop = result.obj.rateEntertainTop;//房产类
				var p_rateEntertainMaximun = result.obj.rateEntertainMaximun;//房产类封顶
				
				if(p_rateLivelihood != null && p_rateLivelihood != ''){
					$('#rateLivelihood').removeAttr("readonly");
				}
				if(p_rateGeneral != null && p_rateGeneral != ''){
					$('#rateGeneral').removeAttr("readonly");
				}
				if(p_rateEntertain != null && p_rateEntertain != ''){
					$('#rateEntertain').removeAttr("readonly");
				}
				if(p_rateGeneralTop != null && p_rateGeneralTop != ''){
					$('#rateGeneralTop').removeAttr("readonly");
					$('#rateGeneralMaximun').removeAttr("readonly");
				}
				if(p_rateEntertainTop != null && p_rateEntertainTop != ''){
					$('#rateEntertainTop').removeAttr("readonly");
					$('#rateEntertainMaximun').removeAttr("readonly");
				}
			}
		},
		error : function(XMLHttpRequest, textStatus) {
			msg.alert("错误", "错误代码：" + XMLHttpRequest.status + ",错误描述："+ textStatus, 'error');
		}
	});
}

</script>
